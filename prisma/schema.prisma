// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User & Auth
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  password      String?
  image         String?
  role          String    @default("student") // student, instructor, employer, alumni, donor, admin
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relations
  enrollments   Enrollment[]
  submissions   Submission[]
  classes       Class[]       @relation("InstructorClasses")
  jobs          Job[]
  applications  Application[]
  donations     Donation[]
  products      Product[]
  mentorships   Mentorship[]  @relation("Mentor")
  mentees       Mentorship[]  @relation("Mentee")
}

// LMS
model Course {
  id          String       @id @default(cuid())
  title       String
  description String
  image       String?
  price       Float        @default(0)
  duration    String?
  level       String?
  category    String?
  published   Boolean      @default(false)
  
  modules     Module[]
  enrollments Enrollment[]
  classes     Class[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt @default(now())
}

model Module {
  id          String   @id @default(cuid())
  title       String
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id])
  lessons     Lesson[]
}

model Lesson {
  id          String   @id @default(cuid())
  title       String
  content     String?
  moduleId    String
  module      Module   @relation(fields: [moduleId], references: [id])
}

model Enrollment {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id])
  progress    Int      @default(0)
  status      String   @default("active") // active, completed
  enrolledAt  DateTime @default(now())
}

// Instructor Portal
model Class {
  id          String   @id @default(cuid())
  name        String
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id])
  instructorId String
  instructor  User     @relation("InstructorClasses", fields: [instructorId], references: [id])
  schedule    String?
  room        String?
  
  assignments Assignment[]
}

model Assignment {
  id          String       @id @default(cuid())
  title       String
  classId     String
  class       Class        @relation(fields: [classId], references: [id])
  dueDate     DateTime
  
  submissions Submission[]
}

model Submission {
  id           String     @id @default(cuid())
  assignmentId String
  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  studentId    String
  student      User       @relation(fields: [studentId], references: [id])
  content      String?
  grade        String?
  status       String     @default("pending") // pending, graded
  submittedAt  DateTime   @default(now())
}

// Employer Portal
model Job {
  id          String        @id @default(cuid())
  title       String
  company     String
  location    String
  type        String        // Full-time, Internship, Apprenticeship
  description String
  postedById  String
  postedBy    User          @relation(fields: [postedById], references: [id])
  createdAt   DateTime      @default(now())
  
  applications Application[]
}

model Application {
  id          String   @id @default(cuid())
  jobId       String
  job         Job      @relation(fields: [jobId], references: [id])
  applicantId String
  applicant   User     @relation(fields: [applicantId], references: [id])
  status      String   @default("pending") // pending, reviewed, accepted, rejected
  appliedAt   DateTime @default(now())
}

// Alumni Network
model Event {
  id          String   @id @default(cuid())
  title       String
  date        DateTime
  location    String
  description String?
  attendees   Int      @default(0)
}

model Mentorship {
  id          String   @id @default(cuid())
  mentorId    String
  mentor      User     @relation("Mentor", fields: [mentorId], references: [id])
  menteeId    String?
  mentee      User?    @relation("Mentee", fields: [menteeId], references: [id])
  status      String   @default("available") // available, active
  expertise   String?
}

// Donor Dashboard
model Donation {
  id          String   @id @default(cuid())
  amount      Float
  cause       String?
  donorId     String
  donor       User     @relation(fields: [donorId], references: [id])
  status      String   @default("completed")
  date        DateTime @default(now())
}

// Marketplace
model Product {
  id          String   @id @default(cuid())
  title       String
  description String?
  price       Float
  image       String?
  category    String
  sellerId    String
  seller      User     @relation(fields: [sellerId], references: [id])
  rating      Float    @default(0)
  createdAt   DateTime @default(now())
}
